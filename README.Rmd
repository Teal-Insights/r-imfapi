---
output: github_document
---

# imfapi

<!-- badges: start -->
[![R-CMD-check](https://github.com/Teal-Insights/r-imfapi/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/Teal-Insights/r-imfapi/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/Teal-Insights/r-imfapi/graph/badge.svg)](https://app.codecov.io/gh/Teal-Insights/r-imfapi)
<!-- badges: end -->

## Installation

```r
install.packages("imfapi")
```

## Usage

```{r}
library(imfapi)
```
```{r}
#| label: truncate_text
#| echo: false
#| output: false
truncate_text <- function(data, max_chars = 10, suffix = "...") {
  data |>
    dplyr::mutate(
      dplyr::across(tidyselect::where(is.character),
        ~ ifelse(
          nchar(.) > max_chars,
          paste0(stringr::str_sub(., 1, max_chars), suffix),
          .
        )
      )
    )
}
```

The `imfapi` package provides a four-step workflow for retrieving data from the IMF's SDMX API:

### Step 1: List available dataflows and select one

Start by listing all available IMF datasets (dataflows) to find the one you need:

```{r}
imf_get_dataflows() |>
  head() |>
  # Note: We use a custom helper function to truncate long strings in columns
  truncate_text(max_chars = 10) |>
  knitr::kable()
```

Choose a dataflow based on its `id`, `name`, and `description`. In this example, we'll use the "PPI" (Producer Price Index) dataflow.

### Step 2: Get the dimensions for filtering

Each dataflow has a datastructure that defines which dimensions you can filter on. Use `imf_get_datastructure()` to see what dimensions are available:

```{r}
imf_get_datastructure(
  "PPI", include_time = TRUE, include_measures = TRUE
) |>
  knitr::kable()
```

The `dimension_id` column shows the filter dimensions you can use (e.g., `COUNTRY`, `FREQUENCY`). Set `include_time = TRUE` to see time dimensions and `include_measures = TRUE` to see measure dimensions.

### Step 3: Fetch codelists for dimensions you want to filter on

For any dimension you want to filter, retrieve its codelist to see the valid codes you can use:

```{r}
imf_get_codelists(dimension_ids = c("COUNTRY"), dataflow_id = "PPI") |>
  head() |>
  truncate_text(max_chars = 10) |>
  knitr::kable()
```

The `code` column shows the values you'll use in your filters (e.g., "USA", "CAN"). The `name` column provides human-readable labels. You can request codelists for multiple dimensions at once by passing a vector of dimension IDs.

### Step 4: Request data with your filters

Finally, use `imf_get()` to fetch the actual data. Pass a named list of dimension filters where each name is a `dimension_id` and each value is a character vector of codes:

``` {r}
imf_get(
  dataflow_id = "PPI",
  dimensions = list(FREQUENCY = c("A"), COUNTRY = c("USA", "CAN"))
) |>
  head()
```

You can also use `start_period` and `end_period` arguments to filter by time (e.g., `start_period = "2015"`, `end_period = "2020"`). If you omit a dimension from the `dimensions` list, all values for that dimension will be included.